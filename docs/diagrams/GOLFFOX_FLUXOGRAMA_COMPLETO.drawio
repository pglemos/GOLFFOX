<mxfile host="app.diagrams.net" modified="2025-01-11T00:00:00.000Z" agent="GolfFox Diagram Generator v2" version="22.1.0" etag="golffox-v2.0.0" type="device">
  <diagram name="GolfFox - Fluxograma Arquitetural Completo v2.0.0" id="golffox-main-flow-v2">
    <mxGraphModel dx="4200" dy="2970" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="4200" pageHeight="2970" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- ============================================ -->
        <!-- CABEÇALHO E METADADOS -->
        <!-- ============================================ -->
        <mxCell id="header" value="GOLFFOX - SISTEMA DE GESTÃO DE TRANSPORTE URBANO&#xa;FLUXOGRAMA ARQUITETURAL COMPLETO - VERSÃO 2.0.0" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=16;fontColor=#1F2937;" vertex="1" parent="1">
          <mxGeometry x="50" y="20" width="4100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="metadata" value="ID: GOLFFOX-DIAG-002 | Data: 11/01/2025 00:00 | Autor: Equipe GolfFox | Versão: v2.0.0 | Última Atualização: Completo e Detalhado" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontColor=#6B7280;" vertex="1" parent="1">
          <mxGeometry x="50" y="80" width="4100" height="25" as="geometry" />
        </mxCell>
        
        <!-- ============================================ -->
        <!-- INÍCIO DO FLUXO -->
        <!-- ============================================ -->
        <mxCell id="start" value="INÍCIO" style="ellipse;whiteSpace=wrap;html=1;fillColor=#10B981;strokeColor=#059669;fontColor=#FFFFFF;fontSize=14;fontStyle=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="2050" y="120" width="120" height="70" as="geometry" />
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 1: ENTRADA DO USUÁRIO -->
        <!-- ============================================ -->
        <mxCell id="user-entry" value="Usuário Acessa Sistema&#xa;(Web ou Mobile)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=11;fontColor=#1E40AF;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="2020" y="220" width="180" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-start-entry" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="start" target="user-entry">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Página de Login -->
        <mxCell id="login-page" value="Página de Login&#xa;(/)&#xa;&#xa;Email + Senha&#xa;CSRF Token" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontSize=10;fontColor=#92400E;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="2020" y="320" width="180" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-entry-login" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="user-entry" target="login-page">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 2: MIDDLEWARE E AUTENTICAÇÃO -->
        <!-- ============================================ -->
        <mxCell id="middleware" value="Middleware Next.js&#xa;(middleware.ts)&#xa;&#xa;• Verifica cookie golffox-session&#xa;• Valida role do usuário&#xa;• Protege rotas /admin, /operator, /carrier&#xa;• Redirecionamento baseado em role" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E9D5FF;strokeColor=#9333EA;fontSize=9;fontColor=#6B21A8;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="1750" y="460" width="240" height="130" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-login-middleware" value="Verifica Cookie" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="login-page" target="middleware">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- API Auth Login -->
        <mxCell id="api-login" value="POST /api/auth/login&#xa;&#xa;• Verifica user em users table&#xa;• Verifica is_active = true&#xa;• Autentica com Supabase Auth&#xa;• Obtém role da tabela users&#xa;• Cria cookie golffox-session (base64)&#xa;• Retorna token + user payload" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEE2E2;strokeColor=#EF4444;fontSize=9;fontColor=#991B1B;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="2020" y="460" width="260" height="150" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-login-api" value="Credenciais" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="login-page" target="api-login">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Outros endpoints Auth -->
        <mxCell id="api-auth-others" value="Endpoints Auth Adicionais:&#xa;&#xa;• POST /api/auth/set-session&#xa;• POST /api/auth/clear-session&#xa;• GET /api/auth/csrf&#xa;• GET /api/auth/me&#xa;• POST /api/auth/seed-admin" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEE2E2;strokeColor=#EF4444;fontSize=9;fontColor=#991B1B;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="2320" y="460" width="220" height="130" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-api-others" value="Sessão" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="api-login" target="api-auth-others">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Decisão de Role -->
        <mxCell id="role-decision" value="Role do Usuário?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#FCD34D;strokeColor=#F59E0B;fontSize=11;fontColor=#78350F;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="2065" y="640" width="140" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-api-role" value="user.role" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="api-login" target="role-decision">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 3: PAINÉIS POR ROLE -->
        <!-- ============================================ -->
        
        <!-- PAINEL ADMIN - Detalhado -->
        <mxCell id="admin-main" value="PAINEL ADMINISTRATIVO&#xa;(/admin)&#xa;Role: admin" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3B82F6;strokeColor=#1E40AF;fontSize=12;fontColor=#FFFFFF;fontStyle=1;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="50" y="800" width="280" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-role-admin" value="admin" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#3B82F6;" edge="1" parent="1" source="role-decision" target="admin-main">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1800" y="690" />
              <mxPoint x="1800" y="835" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Módulos Admin -->
        <mxCell id="admin-dashboard" value="1. Dashboard (/admin)&#xa;• KPIs em tempo real&#xa;• Filtros: empresa, data, turno&#xa;• Total viagens do dia&#xa;• Veículos ativos&#xa;• Funcionários em trânsito&#xa;• Alertas críticos&#xa;• Rotas do dia&#xa;• Log de atividades" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="900" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="admin-mapa" value="2. Mapa da Frota (/admin/mapa)&#xa;• Rastreamento tempo real&#xa;• Playback histórico&#xa;• Export PNG/CSV&#xa;• Filtros avançados&#xa;• Deep-links&#xa;• Legenda interativa" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="330" y="900" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="admin-rotas" value="3. Rotas (/admin/rotas)&#xa;• CRUD completo&#xa;• Geração pontos de parada&#xa;• Otimização de rotas&#xa;• Visualização no mapa&#xa;• /admin/rotas/gerar-pontos" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="610" y="900" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="admin-veiculos" value="4. Veículos (/admin/veiculos)&#xa;• CRUD completo&#xa;• Manutenção preventiva&#xa;• Checklist de veículos&#xa;• Histórico manutenções" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="890" y="900" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="admin-motoristas" value="5. Motoristas (/admin/motoristas)&#xa;• CRUD completo&#xa;• Documentos e certificações&#xa;• Ranking e gamificação&#xa;• Avaliações" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1170" y="900" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="admin-empresas" value="6. Empresas (/admin/empresas)&#xa;• CRUD completo&#xa;• Funcionários cadastrados&#xa;• Associação operadores&#xa;• Configurações branding" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="1070" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="admin-permissoes" value="7. Permissões (/admin/permissoes)&#xa;• Controle de acesso&#xa;• Papéis: admin, operator,&#xa;  carrier, driver, passenger&#xa;• Troca de papéis" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="330" y="1070" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="admin-socorro" value="8. Socorro (/admin/socorro)&#xa;• Despache emergência&#xa;• Histórico ocorrências&#xa;• Status atendimento" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="610" y="1070" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="admin-alertas" value="9. Alertas (/admin/alertas)&#xa;• Histórico com filtros&#xa;• Tipos: erro, aviso, info&#xa;• Busca e paginação" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="890" y="1070" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="admin-relatorios" value="10. Relatórios (/admin/relatorios)&#xa;• Atrasos, ocupação&#xa;• Eficiência rotas&#xa;• Ranking motoristas&#xa;• Export PDF/Excel/CSV&#xa;• Agendamento cron&#xa;• Envio email" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1170" y="1070" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="admin-custos" value="11. Custos (/admin/custos)&#xa;• Cálculo por rota/empresa/veículo&#xa;• Conciliação faturas&#xa;• Orçamentos&#xa;• Categorias&#xa;• Export/Import" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="1240" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="admin-ajuda" value="12. Ajuda &amp; Suporte (/admin/ajuda-suporte)&#xa;• FAQ&#xa;• Suporte WhatsApp&#xa;• Documentação" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="330" y="1240" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="admin-sync" value="13. Sincronização (/admin/sincronizacao)&#xa;• Histórico operações&#xa;• Reprocessamento falhas&#xa;• Status tempo real" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="610" y="1240" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="admin-transportadoras" value="14. Transportadoras (/admin/transportadoras)&#xa;• CRUD completo&#xa;• Associação veículos/motoristas&#xa;• Configurações frota" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="890" y="1240" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="admin-preferences" value="15. Preferências (/admin/preferences)&#xa;• Configurações gerais&#xa;• Preferências exibição&#xa;• /admin/min" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1170" y="1240" width="260" height="140" as="geometry" />
        </mxCell>
        
        <!-- Conexões Admin -->
        <mxCell id="edge-admin-main-dashboard" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="admin-main" target="admin-dashboard">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- PAINEL OPERADOR - Detalhado -->
        <mxCell id="operator-main" value="PAINEL OPERADOR&#xa;(/operator)&#xa;Role: operator, admin" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#10B981;strokeColor=#059669;fontSize=12;fontColor=#FFFFFF;fontStyle=1;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="1500" y="800" width="280" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-role-operator" value="operator" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#10B981;" edge="1" parent="1" source="role-decision" target="operator-main">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Módulos Operator -->
        <mxCell id="operator-dashboard" value="1. Dashboard (/operator)&#xa;• Total viagens&#xa;• Viagens em andamento&#xa;• Viagens concluídas&#xa;• Atrasos &gt; 5min&#xa;• Ocupação média&#xa;• Custo diário&#xa;• SLA D0" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=8;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1500" y="900" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="operator-funcionarios" value="2. Funcionários (/operator/funcionarios)&#xa;• Lista funcionários empresa&#xa;• Busca e filtros&#xa;• Cadastro funcionários&#xa;• Geocodificação endereços" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=8;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1780" y="900" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="operator-rotas" value="3. Rotas (/operator/rotas)&#xa;• Rotas atribuídas&#xa;• Visualização rotas&#xa;• Status das rotas&#xa;• Mapa (/operator/rotas/mapa)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=8;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2060" y="900" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="operator-alertas" value="4. Alertas (/operator/alertas)&#xa;• Alertas específicos&#xa;• Filtros por tipo&#xa;• Busca" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=8;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2340" y="900" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="operator-comunicacoes" value="5. Comunicações (/operator/comunicacoes)&#xa;• Comunicação funcionários" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=8;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1500" y="1070" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="operator-conformidade" value="6. Conformidade (/operator/conformidade)&#xa;• Conformidade regulatória" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=8;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1780" y="1070" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="operator-custos" value="7. Custos (/operator/custos)&#xa;• Custos da empresa" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=8;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2060" y="1070" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="operator-relatorios" value="8. Relatórios (/operator/relatorios)&#xa;• Relatórios da empresa" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=8;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2340" y="1070" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="operator-solicitacoes" value="9. Solicitações (/operator/solicitacoes)&#xa;• Solicitações funcionários" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=8;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1500" y="1240" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="operator-prestadores" value="10. Prestadores (/operator/prestadores)&#xa;• Gestão prestadores" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=8;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1780" y="1240" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="operator-ajuda" value="11. Ajuda (/operator/ajuda)&#xa;• FAQ&#xa;• Suporte WhatsApp&#xa;• Documentação&#xa;• Status sistema" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=8;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2060" y="1240" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="operator-sync" value="12. Sincronizar (/operator/sincronizar)&#xa;• Sincronização dados" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=8;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2340" y="1240" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="operator-prefs" value="13. Preferências (/operator/preferencias)&#xa;• Configurações" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=8;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2620" y="1240" width="260" height="140" as="geometry" />
        </mxCell>
        
        <!-- Conexões Operator -->
        <mxCell id="edge-operator-main-dashboard" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="operator-main" target="operator-dashboard">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- PAINEL TRANSPORTADORA - Detalhado -->
        <mxCell id="carrier-main" value="PAINEL TRANSPORTADORA&#xa;(/carrier)&#xa;Role: carrier, admin" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F59E0B;strokeColor=#D97706;fontSize=12;fontColor=#FFFFFF;fontStyle=1;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="2950" y="800" width="280" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-role-carrier" value="carrier" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#F59E0B;" edge="1" parent="1" source="role-decision" target="carrier-main">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2800" y="690" />
              <mxPoint x="2800" y="835" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Módulos Carrier -->
        <mxCell id="carrier-dashboard" value="1. Dashboard (/carrier)&#xa;• Visão geral transportadora" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontSize=8;fontColor=#78350F;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2950" y="900" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="carrier-mapa" value="2. Mapa (/carrier/mapa)&#xa;• Visualização frota" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontSize=8;fontColor=#78350F;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="3230" y="900" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="carrier-veiculos" value="3. Veículos (/carrier/veiculos)&#xa;• Gestão veículos" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontSize=8;fontColor=#78350F;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="3510" y="900" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="carrier-motoristas" value="4. Motoristas (/carrier/motoristas)&#xa;• Gestão motoristas" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontSize=8;fontColor=#78350F;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="3790" y="900" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="carrier-relatorios" value="5. Relatórios (/carrier/relatorios)&#xa;• Relatórios transportadora" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontSize=8;fontColor=#78350F;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2950" y="1070" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="carrier-alertas" value="6. Alertas (/carrier/alertas)&#xa;• Alertas transportadora" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontSize=8;fontColor=#78350F;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="3230" y="1070" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="carrier-custos" value="7. Custos (/carrier/custos)&#xa;• Custos por rota&#xa;• Custos por veículo&#xa;• Relatórios financeiros" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontSize=8;fontColor=#78350F;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="3510" y="1070" width="260" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="carrier-ajuda" value="8. Ajuda (/carrier/ajuda)&#xa;• Central ajuda" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontSize=8;fontColor=#78350F;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="3790" y="1070" width="260" height="140" as="geometry" />
        </mxCell>
        
        <!-- Conexões Carrier -->
        <mxCell id="edge-carrier-main-dashboard" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="carrier-main" target="carrier-dashboard">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- APP MOTORISTA - Flutter -->
        <mxCell id="driver-app" value="APP MOTORISTA&#xa;(Flutter Mobile)&#xa;Role: driver" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9333EA;strokeColor=#7C3AED;fontSize=12;fontColor=#FFFFFF;fontStyle=1;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="50" y="1450" width="280" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-role-driver" value="driver" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#9333EA;" edge="1" parent="1" source="role-decision" target="driver-app">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1800" y="690" />
              <mxPoint x="1800" y="1485" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Módulos Driver App -->
        <mxCell id="driver-features" value="Módulos App Motorista:&#xa;• Login/Check-in/out&#xa;• Rotas do dia&#xa;• GPS tracking (tempo real)&#xa;• Notificações&#xa;• Histórico viagens&#xa;• Comunicação central" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E9D5FF;strokeColor=#9333EA;fontSize=9;fontColor=#6B21A8;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="1550" width="280" height="160" as="geometry" />
        </mxCell>
        
        <!-- APP PASSAGEIRO - Flutter -->
        <mxCell id="passenger-app" value="APP PASSAGEIRO&#xa;(Flutter Mobile)&#xa;Role: passenger" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#06B6D4;strokeColor=#0891B2;fontSize=12;fontColor=#FFFFFF;fontStyle=1;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="370" y="1450" width="280" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-role-passenger" value="passenger" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#06B6D4;" edge="1" parent="1" source="role-decision" target="passenger-app">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2800" y="690" />
              <mxPoint x="2800" y="1485" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Módulos Passenger App -->
        <mxCell id="passenger-features" value="Módulos App Passageiro:&#xa;• Login&#xa;• Rastreamento tempo real&#xa;• Notificações chegada&#xa;• Informações rotas/horários&#xa;• Avaliação serviço" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CFFAFE;strokeColor=#06B6D4;fontSize=9;fontColor=#164E63;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="370" y="1550" width="280" height="160" as="geometry" />
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 4: API ROUTES - DETALHADO -->
        <!-- ============================================ -->
        <mxCell id="api-layer" value="API ROUTES LAYER&#xa;(Next.js App Router)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DC2626;strokeColor=#991B1B;fontSize=11;fontColor=#FFFFFF;fontStyle=1;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="50" y="1780" width="3900" height="50" as="geometry" />
        </mxCell>
        
        <!-- API Admin - Detalhado -->
        <mxCell id="api-admin" value="API ADMIN (/api/admin/*)&#xa;&#xa;GET /kpis&#xa;GET /alerts-list, /alerts/[id]&#xa;DELETE /alerts/delete&#xa;GET /assistance-requests-list, /assistance-requests/[id]&#xa;DELETE /assistance-requests/delete&#xa;GET /audit-db, /audit-log&#xa;POST /carriers/create, PUT /update, DELETE /delete&#xa;GET /carriers-list, /carriers/[id]/drivers/vehicles/users&#xa;POST /companies, GET /companies-list, /companies/[id]&#xa;DELETE /companies/delete&#xa;GET /costs-options&#xa;POST /create-operator, /create-operator-login, /create-carrier-login&#xa;GET /drivers-list, POST /drivers, GET /drivers/[id], DELETE /delete&#xa;GET /employees-list&#xa;POST /execute-sql-fix, /fix-database&#xa;POST /generate-stops, /optimize-route&#xa;GET /routes-list, POST /routes, DELETE /routes/delete&#xa;POST /seed-cost-categories&#xa;GET /trips, /trips/[id]&#xa;GET /users-list, /users/[id], DELETE /users/delete&#xa;GET /vehicles-list, POST /vehicles, GET /vehicles/[id], PUT /vehicles/[id], DELETE /vehicles/delete" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEE2E2;strokeColor=#EF4444;fontSize=7;fontColor=#991B1B;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="1860" width="280" height="250" as="geometry" />
        </mxCell>
        
        <!-- API Operator -->
        <mxCell id="api-operator" value="API OPERATOR (/api/operator/*)&#xa;&#xa;• Associate Company&#xa;• Create Employee&#xa;• Optimize Route" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEE2E2;strokeColor=#EF4444;fontSize=8;fontColor=#991B1B;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="350" y="1860" width="280" height="200" as="geometry" />
        </mxCell>
        
        <!-- API Carrier - Detalhado -->
        <mxCell id="api-carrier" value="API CARRIER (/api/carrier/*)&#xa;&#xa;GET /alerts&#xa;GET /costs/route, /costs/vehicle&#xa;GET /drivers/[id]/documents, /drivers/[id]/exams&#xa;GET /reports/driver-performance&#xa;GET /reports/fleet-usage&#xa;GET /reports/trips&#xa;POST /storage/signed-url&#xa;POST /upload&#xa;GET /vehicles/[id]/documents&#xa;GET /vehicles/[id]/maintenances" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEE2E2;strokeColor=#EF4444;fontSize=7;fontColor=#991B1B;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="650" y="1860" width="280" height="250" as="geometry" />
        </mxCell>
        
        <!-- API Costs - Detalhado -->
        <mxCell id="api-costs" value="API COSTS (/api/costs/*)&#xa;&#xa;GET /kpis&#xa;GET /budgets, POST /budgets, DELETE /budgets&#xa;GET /categories&#xa;POST /manual, GET /manual&#xa;POST /reconcile&#xa;GET /export&#xa;POST /import&#xa;GET /vs-budget" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEE2E2;strokeColor=#EF4444;fontSize=7;fontColor=#991B1B;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="950" y="1860" width="280" height="250" as="geometry" />
        </mxCell>
        
        <!-- API Reports -->
        <mxCell id="api-reports" value="API REPORTS (/api/reports/*)&#xa;&#xa;• Run&#xa;• Schedule&#xa;• Dispatch" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEE2E2;strokeColor=#EF4444;fontSize=8;fontColor=#991B1B;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1250" y="1860" width="280" height="200" as="geometry" />
        </mxCell>
        
        <!-- API Cron -->
        <mxCell id="api-cron" value="API CRON (/api/cron/*)&#xa;&#xa;• Refresh KPIs&#xa;• Refresh Costs MV&#xa;• Dispatch Reports" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEE2E2;strokeColor=#EF4444;fontSize=8;fontColor=#991B1B;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1550" y="1860" width="280" height="200" as="geometry" />
        </mxCell>
        
        <!-- API Notifications -->
        <mxCell id="api-notifications" value="API NOTIFICATIONS (/api/notifications/*)&#xa;&#xa;• Check Proximity&#xa;• Email" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEE2E2;strokeColor=#EF4444;fontSize=8;fontColor=#991B1B;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1850" y="1860" width="280" height="200" as="geometry" />
        </mxCell>
        
        <!-- API Analytics -->
        <mxCell id="api-analytics" value="API ANALYTICS (/api/analytics/*)&#xa;&#xa;• Web Vitals" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEE2E2;strokeColor=#EF4444;fontSize=8;fontColor=#991B1B;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2150" y="1860" width="280" height="200" as="geometry" />
        </mxCell>
        
        <!-- API Docs -->
        <mxCell id="api-docs" value="API DOCS (/api/docs/*)&#xa;&#xa;• OpenAPI" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEE2E2;strokeColor=#EF4444;fontSize=8;fontColor=#991B1B;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2450" y="1860" width="280" height="200" as="geometry" />
        </mxCell>
        
        <!-- API Health -->
        <mxCell id="api-health" value="API HEALTH (/api/health)&#xa;&#xa;• Health Check" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEE2E2;strokeColor=#EF4444;fontSize=8;fontColor=#991B1B;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2750" y="1860" width="280" height="200" as="geometry" />
        </mxCell>
        
        <!-- Conexões API Layer -->
        <mxCell id="edge-admin-api" value="Request" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="admin-main" target="api-layer">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="190" y="1750" />
              <mxPoint x="190" y="1805" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="edge-operator-api" value="Request" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="operator-main" target="api-layer">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1640" y="1750" />
              <mxPoint x="1640" y="1805" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="edge-carrier-api" value="Request" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="carrier-main" target="api-layer">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3090" y="1750" />
              <mxPoint x="3090" y="1805" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="edge-api-admin" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="api-layer" target="api-admin">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-api-operator" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="api-layer" target="api-operator">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-api-carrier" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="api-layer" target="api-carrier">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 5: SUPABASE CLIENT -->
        <!-- ============================================ -->
        <mxCell id="supabase-client" value="SUPABASE CLIENT&#xa;(lib/supabase.ts)&#xa;&#xa;• Cliente configurado&#xa;• Service Role Key&#xa;• Anon Key&#xa;• Configurações projeto" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#10B981;strokeColor=#059669;fontSize=9;fontColor=#FFFFFF;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="3050" y="1860" width="280" height="150" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-api-supabase" value="Query/Subscription" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="api-layer" target="supabase-client">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3950" y="1955" />
              <mxPoint x="3190" y="1955" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 6: SUPABASE BACKEND -->
        <!-- ============================================ -->
        <mxCell id="supabase-backend" value="SUPABASE BACKEND&#xa;&#xa;PostgreSQL Database&#xa;Authentication&#xa;Realtime (WebSocket)&#xa;Storage&#xa;Edge Functions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3B82F6;strokeColor=#1E40AF;fontSize=10;fontColor=#FFFFFF;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="3370" y="1860" width="280" height="150" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-supabase-backend" value="SQL/WebSocket" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="supabase-client" target="supabase-backend">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 7: BANCO DE DADOS - TABELAS -->
        <!-- ============================================ -->
        <mxCell id="db-tables" value="TABELAS PRINCIPAIS (50+ tabelas)&#xa;&#xa;Core: users, companies, carriers&#xa;Frota: vehicles, drivers, routes&#xa;Viagens: trips, driver_positions, trip_events, trip_summary, trip_passengers, checklists&#xa;Multi-tenant: gf_user_company_map, gf_employee_company, gf_carrier_driver_map, gf_carrier_vehicle_map&#xa;Custos: gf_costs, gf_cost_categories, gf_cost_budgets, gf_cost_reconciliation&#xa;Notificações: gf_notifications, gf_boarding_tokens&#xa;Socorro: gf_incidents, gf_service_requests, gf_assistance_requests&#xa;Auditoria: audit_logs, gf_audit_events&#xa;Gamificação: gf_driver_rankings, gf_achievements&#xa;Mapa: gf_map_snapshots, gf_route_optimization_cache&#xa;Relatórios: gf_report_schedules, gf_report_history" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontSize=7;fontColor=#78350F;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="3690" y="1860" width="260" height="300" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-backend-db" value="SQL Query" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="supabase-backend" target="db-tables">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 8: VIEWS E MATERIALIZED VIEWS -->
        <!-- ============================================ -->
        <mxCell id="db-views" value="VIEWS E MATERIALIZED VIEWS (30+ views)&#xa;&#xa;Multi-tenant: v_my_companies&#xa;KPIs: v_admin_kpis, mv_operator_kpis, v_carrier_kpis&#xa;Rastreamento: v_driver_last_position, v_active_trips, v_trip_positions&#xa;Relatórios: v_reports_delays, v_reports_occupancy, v_reports_route_efficiency, v_trip_reports&#xa;Custos: v_costs_by_route, v_costs_by_vehicle, v_costs_summary, mv_costs_aggregated&#xa;Mapa: v_map_active_vehicles, v_map_route_traffic, v_map_incidents&#xa;Operador: v_operator_employees_secure, v_operator_routes, v_operator_trips&#xa;Transportadora: v_carrier_fleet_status, v_carrier_driver_performance" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontSize=7;fontColor=#78350F;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="2120" width="280" height="240" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-db-views" value="Query" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="db-tables" target="db-views">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3900" y="2090" />
              <mxPoint x="190" y="2090" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 9: RLS POLICIES -->
        <!-- ============================================ -->
        <mxCell id="rls-policies" value="ROW LEVEL SECURITY (RLS)&#xa;&#xa;Políticas por role:&#xa;• Admin: acesso total&#xa;• Operator: dados empresa (company_id)&#xa;• Carrier: dados transportadora (carrier_id)&#xa;• Driver: próprias viagens (driver_id)&#xa;• Passenger: viagens atribuídas&#xa;&#xa;Todas tabelas protegidas" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEE2E2;strokeColor=#EF4444;fontSize=9;fontColor=#991B1B;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="350" y="2120" width="280" height="180" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-db-rls" value="Security Check" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="db-tables" target="rls-policies">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3900" y="2080" />
              <mxPoint x="490" y="2080" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 10: REALTIME SUBSCRIPTIONS -->
        <!-- ============================================ -->
        <mxCell id="realtime" value="SUPABASE REALTIME&#xa;(WebSocket)&#xa;&#xa;Tabelas publicadas:&#xa;• driver_positions&#xa;• trips (status)&#xa;• gf_incidents&#xa;• gf_service_requests&#xa;• gf_notifications" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#A78BFA;strokeColor=#7C3AED;fontSize=9;fontColor=#FFFFFF;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="650" y="2120" width="280" height="180" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-backend-realtime" value="WebSocket" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#A78BFA;" edge="1" parent="1" source="supabase-backend" target="realtime">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3510" y="2050" />
              <mxPoint x="790" y="2050" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 11: FUNÇÕES E RPCs -->
        <!-- ============================================ -->
        <mxCell id="db-functions" value="FUNÇÕES E RPCs (20+ funções)&#xa;&#xa;Viagens: rpc_trip_transition, rpc_calculate_trip_summary, rpc_reopen_trip&#xa;Rotas: rpc_optimize_route, rpc_generate_stops, rpc_request_route_change&#xa;Socorro: rpc_raise_incident, rpc_request_service, rpc_dispatch_assistance&#xa;Mapa: rpc_map_snapshot, rpc_get_fleet_positions, rpc_route_traffic_analysis&#xa;Operador: rpc_create_employee, rpc_associate_company, rpc_operator_stats&#xa;Custos: rpc_calculate_route_cost, rpc_reconcile_costs, rpc_export_costs&#xa;Relatórios: rpc_generate_report, rpc_schedule_report, rpc_dispatch_report" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontSize=7;fontColor=#78350F;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="950" y="2120" width="280" height="240" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-db-functions" value="RPC Call" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="db-tables" target="db-functions">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3900" y="2070" />
              <mxPoint x="1090" y="2070" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 12: TRIGGERS -->
        <!-- ============================================ -->
        <mxCell id="db-triggers" value="TRIGGERS (15+ triggers)&#xa;&#xa;Viagens: trip_summary_calculation (driver_positions), trip_status_trigger&#xa;Auditoria: audit_log_trigger (todas tabelas), gf_audit_events_trigger&#xa;Timestamps: updated_at_trigger (todas tabelas), created_at_default&#xa;Usuários: user_creation_trigger, user_profile_sync_trigger&#xa;Custos: cost_recalculation_trigger, budget_check_trigger&#xa;Notificações: notification_dispatch_trigger, proximity_check_trigger&#xa;RLS: rls_enforcement_trigger, row_security_check" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontSize=7;fontColor=#78350F;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="1250" y="2120" width="280" height="240" as="geometry" />
        </mxCell>
        
        <mxCell id="edge-db-triggers" value="Auto-execute" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="db-tables" target="db-triggers">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3900" y="2060" />
              <mxPoint x="1390" y="2060" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 13: INTEGRAÇÕES EXTERNAS -->
        <!-- ============================================ -->
        <mxCell id="integrations" value="INTEGRAÇÕES EXTERNAS" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6366F1;strokeColor=#4F46E5;fontSize=11;fontColor=#FFFFFF;fontStyle=1;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="1550" y="2120" width="2400" height="50" as="geometry" />
        </mxCell>
        
        <!-- Google Maps -->
        <mxCell id="google-maps" value="GOOGLE MAPS API&#xa;&#xa;• Rastreamento GPS&#xa;• Geocodificação&#xa;• Otimização rotas&#xa;• Visualização mapa&#xa;• @react-google-maps/api" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=9;fontColor=#1E40AF;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="1550" y="2200" width="280" height="140" as="geometry" />
        </mxCell>
        
        <!-- Sentry -->
        <mxCell id="sentry" value="SENTRY&#xa;&#xa;• Monitoramento erros&#xa;• @sentry/nextjs&#xa;• sentry_flutter" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=9;fontColor=#1E40AF;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="1850" y="2200" width="280" height="140" as="geometry" />
        </mxCell>
        
        <!-- Vercel -->
        <mxCell id="vercel" value="VERCEL&#xa;&#xa;• Hosting Next.js&#xa;• Cron Jobs&#xa;• Speed Insights&#xa;• Edge Functions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=9;fontColor=#1E40AF;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="2150" y="2200" width="280" height="140" as="geometry" />
        </mxCell>
        
        <!-- Resend/Email -->
        <mxCell id="resend" value="RESEND / EMAIL&#xa;&#xa;• Envio emails&#xa;• Relatórios agendados&#xa;• Notificações" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=9;fontColor=#1E40AF;strokeWidth=2;align=left;" vertex="1" parent="1">
          <mxGeometry x="2450" y="2200" width="280" height="140" as="geometry" />
        </mxCell>
        
        <!-- Conexões Integrações -->
        <mxCell id="edge-maps-admin" value="API Call" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="admin-mapa" target="google-maps">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="460" y="2050" />
              <mxPoint x="1690" y="2050" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 14: SISTEMAS AUXILIARES -->
        <!-- ============================================ -->
        <mxCell id="aux-systems" value="SISTEMAS AUXILIARES" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#EC4899;strokeColor=#BE185D;fontSize=11;fontColor=#FFFFFF;fontStyle=1;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="2750" y="2200" width="1200" height="50" as="geometry" />
        </mxCell>
        
        <!-- Notificações -->
        <mxCell id="notifications" value="SISTEMA NOTIFICAÇÕES&#xa;&#xa;• /api/notifications/email&#xa;• /api/notifications/check-proximity&#xa;• gf_notifications table&#xa;• Push tempo real" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE7F3;strokeColor=#EC4899;fontSize=8;fontColor=#BE185D;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2750" y="2280" width="280" height="140" as="geometry" />
        </mxCell>
        
        <!-- Relatórios -->
        <mxCell id="reports" value="SISTEMA RELATÓRIOS&#xa;&#xa;• /api/reports/run&#xa;• /api/reports/schedule&#xa;• /api/reports/dispatch&#xa;• Export PDF/Excel/CSV&#xa;• Agendamento cron" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE7F3;strokeColor=#EC4899;fontSize=8;fontColor=#BE185D;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="3050" y="2280" width="280" height="140" as="geometry" />
        </mxCell>
        
        <!-- Custos -->
        <mxCell id="costs" value="SISTEMA CUSTOS&#xa;&#xa;• /api/costs/kpis&#xa;• /api/costs/budgets&#xa;• /api/costs/reconcile&#xa;• gf_costs table&#xa;• Materialized Views" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE7F3;strokeColor=#EC4899;fontSize=8;fontColor=#BE185D;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="3350" y="2280" width="280" height="140" as="geometry" />
        </mxCell>
        
        <!-- Storage -->
        <mxCell id="storage" value="SUPABASE STORAGE&#xa;&#xa;• Documentos veículos&#xa;• Documentos motoristas&#xa;• Imagens e anexos&#xa;• Signed URLs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE7F3;strokeColor=#EC4899;fontSize=8;fontColor=#BE185D;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="3650" y="2280" width="280" height="140" as="geometry" />
        </mxCell>
        
        <!-- Monitoramento -->
        <mxCell id="monitoring" value="MONITORAMENTO&#xa;&#xa;• Sentry (Erros)&#xa;• Vercel Speed Insights&#xa;• Web Vitals&#xa;• /api/analytics/web-vitals" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE7F3;strokeColor=#EC4899;fontSize=8;fontColor=#BE185D;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2750" y="2450" width="280" height="140" as="geometry" />
        </mxCell>
        
        <!-- Cron Jobs -->
        <mxCell id="cron-jobs" value="CRON JOBS (Vercel)&#xa;&#xa;• /api/cron/refresh-kpis&#xa;• /api/cron/dispatch-reports&#xa;• /api/cron/refresh-costs-mv&#xa;• Agendamento automático" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE7F3;strokeColor=#EC4899;fontSize=8;fontColor=#BE185D;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="3050" y="2450" width="280" height="140" as="geometry" />
        </mxCell>
        
        <!-- Flutter Connection -->
        <mxCell id="flutter-connection" value="FLUTTER APP CONNECTION&#xa;&#xa;• supabase_flutter&#xa;• Riverpod State&#xa;• Go Router&#xa;• Real-time subscriptions&#xa;• GPS tracking" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CFFAFE;strokeColor=#06B6D4;fontSize=8;fontColor=#164E63;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="3350" y="2450" width="280" height="140" as="geometry" />
        </mxCell>
        
        <!-- Web Connection -->
        <mxCell id="web-connection" value="NEXT.JS WEB CONNECTION&#xa;&#xa;• React Query&#xa;• TanStack Query&#xa;• SWR&#xa;• Real-time hooks&#xa;• Zustand State" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=8;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="3650" y="2450" width="280" height="140" as="geometry" />
        </mxCell>
        
        <!-- Conexões Auxiliares -->
        <mxCell id="edge-realtime-flutter" value="Live Updates" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#A78BFA;" edge="1" parent="1" source="realtime" target="flutter-connection">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1090" y="2240" />
              <mxPoint x="3490" y="2240" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="edge-realtime-web" value="Live Updates" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#A78BFA;" edge="1" parent="1" source="realtime" target="web-connection">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1090" y="2220" />
              <mxPoint x="3790" y="2220" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="edge-notif-realtime" value="Push" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="notifications" target="realtime">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2890" y="2350" />
              <mxPoint x="1090" y="2350" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="edge-storage-backend" value="Upload/Download" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;dashed=1;" edge="1" parent="1" source="storage" target="supabase-backend">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3790" y="2350" />
              <mxPoint x="3510" y="2350" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 15: MOBILE APP FEATURES -->
        <!-- ============================================ -->
        <mxCell id="mobile-features" value="FEATURES MOBILE APP (Flutter)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#10B981;strokeColor=#059669;fontSize=11;fontColor=#FFFFFF;fontStyle=1;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="50" y="2620" width="3900" height="50" as="geometry" />
        </mxCell>
        
        <!-- Driver App Features -->
        <mxCell id="driver-features-detailed" value="APP MOTORISTA FEATURES&#xa;&#xa;• Login/Check-in/Check-out&#xa;• Rotas do dia&#xa;• GPS tracking (10s intervalos)&#xa;• Envio posições tempo real&#xa;• Notificações (passageiro confirmado, chegada ponto)&#xa;• Histórico viagens&#xa;• Comunicação central&#xa;• Checklist veículo (pre/post trip)&#xa;• Transições estado viagem (scheduled→inProgress→completed)&#xa;• Offline queue com retry" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E9D5FF;strokeColor=#9333EA;fontSize=7;fontColor=#6B21A8;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="50" y="2700" width="280" height="220" as="geometry" />
        </mxCell>
        
        <!-- Passenger App Features -->
        <mxCell id="passenger-features-detailed" value="APP PASSAGEIRO FEATURES&#xa;&#xa;• Login (CPF + senha)&#xa;• Rastreamento tempo real do ônibus&#xa;• Notificações chegada (5 min antes)&#xa;• Informações rotas/horários&#xa;• Avaliação serviço&#xa;• Confirmação embarque (NFC/QR)&#xa;• Histórico viagens&#xa;• Reportar incidentes&#xa;• Chat com motorista/central" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#CFFAFE;strokeColor=#06B6D4;fontSize=7;fontColor=#164E63;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="350" y="2700" width="280" height="220" as="geometry" />
        </mxCell>
        
        <!-- Mobile Core -->
        <mxCell id="mobile-core" value="MOBILE CORE (Flutter)&#xa;&#xa;• core/auth (AuthManager, AuthService, AuthRepository)&#xa;• core/config (AppConfig, env vars)&#xa;• core/error (ErrorHandler, AppError, ErrorFactory)&#xa;• core/logging (AppLogger, mascaramento dados)&#xa;• core/routing (GoRouter, guards)&#xa;• core/security (RateLimiter, DataSanitizer)&#xa;• core/theme (Temas Apple/Tesla/Nubank)&#xa;• core/supabase (Cliente configurado)&#xa;• core/utils, core/validation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=7;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="650" y="2700" width="280" height="220" as="geometry" />
        </mxCell>
        
        <!-- Mobile Features -->
        <mxCell id="mobile-features-list" value="MOBILE FEATURES MODULES (18 módulos)&#xa;&#xa;• auth (Login, sign up, sign out)&#xa;• driver (App Motorista completo)&#xa;• passenger (App Passageiro completo)&#xa;• mapa (Rastreamento GPS, mapas)&#xa;• routes (Gestão rotas)&#xa;• vehicles (Gestão veículos)&#xa;• alertas (Sistema alertas)&#xa;• custos (Visualização custos)&#xa;• relatorios (Relatórios mobile)&#xa;• operator (Features operador)&#xa;• carrier (Features transportadora)&#xa;• empresas, permissoes, socorro, historico, drivers" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D1FAE5;strokeColor=#10B981;fontSize=7;fontColor=#065F46;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="950" y="2700" width="280" height="220" as="geometry" />
        </mxCell>
        
        <!-- ============================================ -->
        <!-- CAMADA 16: MIGRATIONS E ESTRUTURA DB -->
        <!-- ============================================ -->
        <mxCell id="db-migrations" value="MIGRATIONS DATABASE&#xa;(60 arquivos SQL - v41 até v74)&#xa;&#xa;v41: Gamificação, Views KPIs, RPCs rotas&#xa;v42: Realtime tables habilitadas&#xa;v43: Admin core, MatViews, RLS, Views, Operator RLS&#xa;v44: Costs taxonomy, MatViews, Views, Map views, Operator employees&#xa;v45: LGPD PII protection&#xa;v46: Route optimization, Map advanced features&#xa;v47: Vehicle columns, Trip summary trigger fix&#xa;v48-v49: Auth user creation, RLS fixes, User creation trigger, Protect user_company_map&#xa;v50-v54: Carrier complete (driver docs, vehicle mgmt, costs, dashboard views, storage)&#xa;v74: Canonical migration completa&#xa;Auxiliares: gf_operator_tables, gf_operator_rpcs, gf_operator_views, gf_views, gf_notifications_boarding, gf_rpc_map_snapshot, vehicle_positions_realtime" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FEF3C7;strokeColor=#F59E0B;fontSize=7;fontColor=#78350F;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1250" y="2700" width="280" height="260" as="geometry" />
        </mxCell>
        
        <!-- ============================================ -->
        <!-- FIM -->
        <!-- ============================================ -->
        <mxCell id="end" value="FIM" style="ellipse;whiteSpace=wrap;html=1;fillColor=#EF4444;strokeColor=#DC2626;fontColor=#FFFFFF;fontSize=14;fontStyle=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="2050" y="2720" width="120" height="70" as="geometry" />
        </mxCell>
        
        <!-- Rodapé -->
        <!-- Páginas adicionais -->
        <mxCell id="other-pages" value="OUTRAS PÁGINAS&#xa;&#xa;• /driver (Painel Web Motorista)&#xa;• /passenger (Painel Web Passageiro)&#xa;• /diagnostico (Diagnóstico sistema)&#xa;• /unauthorized (Não autorizado)&#xa;• /test-auth, /test-login, /test-sidebar (Testes)&#xa;• /sentry-example-page (Exemplo Sentry)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=7;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1550" y="2700" width="280" height="220" as="geometry" />
        </mxCell>
        
        <!-- Componentes React -->
        <mxCell id="react-components" value="COMPONENTES REACT&#xa;&#xa;UI Base: ui/ (Radix UI components)&#xa;Admin: admin/ (Componentes Admin)&#xa;Operator: operator/ (Componentes Operador)&#xa;Carrier: carrier/ (Componentes Transportadora)&#xa;Modals: modals/ (Modais diversos)&#xa;Providers: providers/ (Context providers)&#xa;Costs: costs/ (Componentes custos)&#xa;Login: login/ (Componentes login)&#xa;Admin Map: admin-map/ (Componentes mapa)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=7;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1850" y="2700" width="280" height="220" as="geometry" />
        </mxCell>
        
        <!-- Hooks Customizados -->
        <mxCell id="react-hooks" value="HOOKS REACT CUSTOMIZADOS&#xa;&#xa;• use-auth-fast (Autenticação rápida)&#xa;• use-operator-data (KPIs operador)&#xa;• use-operator-tenant (Multi-tenant)&#xa;• use-realtime-updates (Updates tempo real)&#xa;• use-operator-kpis, use-control-tower" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=7;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2150" y="2700" width="280" height="220" as="geometry" />
        </mxCell>
        
        <!-- State Management -->
        <mxCell id="state-management" value="GERENCIAMENTO DE ESTADO&#xa;&#xa;Flutter: Riverpod (Provider pattern)&#xa;• providers/ (State providers)&#xa;• Riverpod Generator&#xa;&#xa;Next.js:&#xa;• Zustand (Global state)&#xa;• TanStack Query (Server state)&#xa;• SWR (Data fetching)&#xa;• React Context (Local state)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DBEAFE;strokeColor=#3B82F6;fontSize=7;fontColor=#1E40AF;strokeWidth=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2450" y="2700" width="280" height="220" as="geometry" />
        </mxCell>
        
        <mxCell id="footer" value="© 2025 - GolfFox | GOLFFOX_FLUXOGRAMA_COMPLETO_v2.0.0.drawio | Escala: 1:1 | Página 1 de 1 | Total: 89 API routes, 50+ tabelas, 30+ views, 20+ funções, 15+ triggers, 60 migrations, 18 módulos mobile" style="text;html=1;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontColor=#6B7280;" vertex="1" parent="1">
          <mxGeometry x="2100" y="2950" width="1850" height="30" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
