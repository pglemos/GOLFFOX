{
  "tech_stack": [
    "TypeScript",
    "Next.js 15",
    "React 18",
    "Tailwind CSS",
    "PostgreSQL",
    "Supabase",
    "Google Maps API",
    "Node.js",
    "Vercel"
  ],
  "features": [
    {
      "name": "Authentication API",
      "description": "Sistema de autenticação com login, logout, CSRF protection e gerenciamento de sessão",
      "files": [
        "web-app/app/api/auth/login/route.ts",
        "web-app/app/api/auth/csrf/route.ts",
        "web-app/app/api/auth/set-session/route.ts",
        "web-app/app/api/auth/clear-session/route.ts",
        "web-app/app/api/auth/seed-admin/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": {
          "title": "Authentication API",
          "version": "1.0.0",
          "description": "APIs para autenticação de usuários"
        },
        "paths": {
          "/api/auth/login": {
            "post": {
              "summary": "Login de usuário",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "email": { "type": "string", "format": "email" },
                        "password": { "type": "string" }
                      },
                      "required": ["email", "password"]
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Login bem-sucedido",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "token": { "type": "string" },
                          "user": { "type": "object" }
                        }
                      }
                    }
                  }
                },
                "401": { "description": "Credenciais inválidas" }
              }
            }
          },
          "/api/auth/csrf": {
            "get": {
              "summary": "Obter token CSRF",
              "responses": {
                "200": {
                  "description": "Token CSRF gerado",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "csrfToken": { "type": "string" }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Admin API",
      "description": "APIs para gerenciamento administrativo: criação de operadores, veículos, rotas, empresas",
      "files": [
        "web-app/app/api/admin/create-operator/route.ts",
        "web-app/app/api/admin/vehicles/[vehicleId]/route.ts",
        "web-app/app/api/admin/generate-stops/route.ts",
        "web-app/app/api/admin/optimize-route/route.ts",
        "web-app/app/api/admin/audit-db/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": {
          "title": "Admin API",
          "version": "1.0.0"
        },
        "paths": {
          "/api/admin/create-operator": {
            "post": {
              "summary": "Criar operador e empresa",
              "security": [{"bearerAuth": []}],
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "companyName": { "type": "string" },
                        "operatorEmail": { "type": "string", "format": "email" },
                        "operatorPhone": { "type": "string" }
                      },
                      "required": ["companyName", "operatorEmail"]
                    }
                  }
                }
              },
              "responses": {
                "201": { "description": "Operador criado com sucesso" },
                "400": { "description": "Dados inválidos" },
                "401": { "description": "Não autorizado" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Operator API",
      "description": "APIs para operadores: criação de funcionários, otimização de rotas, associação de empresas",
      "files": [
        "web-app/app/api/operator/create-employee/route.ts",
        "web-app/app/api/operator/optimize-route/route.ts",
        "web-app/app/api/operator/associate-company/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": {
          "title": "Operator API",
          "version": "1.0.0"
        },
        "paths": {
          "/api/operator/create-employee": {
            "post": {
              "summary": "Criar funcionário",
              "security": [{"bearerAuth": []}],
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "email": { "type": "string", "format": "email" },
                        "name": { "type": "string" },
                        "phone": { "type": "string" },
                        "role": { "type": "string", "enum": ["passenger", "driver"] }
                      },
                      "required": ["email", "name"]
                    }
                  }
                }
              },
              "responses": {
                "201": { "description": "Funcionário criado" },
                "400": { "description": "Dados inválidos" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Costs API",
      "description": "APIs para gestão de custos: orçamentos, categorias, KPIs, reconciliação, import/export",
      "files": [
        "web-app/app/api/costs/budgets/route.ts",
        "web-app/app/api/costs/categories/route.ts",
        "web-app/app/api/costs/kpis/route.ts",
        "web-app/app/api/costs/reconcile/route.ts",
        "web-app/app/api/costs/manual/route.ts",
        "web-app/app/api/costs/import/route.ts",
        "web-app/app/api/costs/export/route.ts",
        "web-app/app/api/costs/vs-budget/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": {
          "title": "Costs API",
          "version": "1.0.0"
        },
        "paths": {
          "/api/costs/budgets": {
            "get": {
              "summary": "Listar orçamentos",
              "responses": {
                "200": {
                  "description": "Lista de orçamentos",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "array",
                        "items": { "type": "object" }
                      }
                    }
                  }
                }
              }
            },
            "post": {
              "summary": "Criar orçamento",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "name": { "type": "string" },
                        "amount": { "type": "number" },
                        "period": { "type": "string" }
                      }
                    }
                  }
                }
              },
              "responses": {
                "201": { "description": "Orçamento criado" }
              }
            }
          },
          "/api/costs/kpis": {
            "get": {
              "summary": "Obter KPIs de custos",
              "responses": {
                "200": {
                  "description": "KPIs de custos",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "totalCosts": { "type": "number" },
                          "budget": { "type": "number" },
                          "variance": { "type": "number" }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Reports API",
      "description": "APIs para geração e agendamento de relatórios",
      "files": [
        "web-app/app/api/reports/run/route.ts",
        "web-app/app/api/reports/schedule/route.ts",
        "web-app/app/api/reports/dispatch/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": {
          "title": "Reports API",
          "version": "1.0.0"
        },
        "paths": {
          "/api/reports/run": {
            "post": {
              "summary": "Executar relatório",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "reportType": { "type": "string" },
                        "format": { "type": "string", "enum": ["pdf", "excel", "csv"] },
                        "filters": { "type": "object" }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": { "description": "Relatório gerado" }
              }
            }
          },
          "/api/reports/schedule": {
            "post": {
              "summary": "Agendar relatório",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "reportType": { "type": "string" },
                        "schedule": { "type": "string" },
                        "recipients": { "type": "array", "items": { "type": "string" } }
                      }
                    }
                  }
                }
              },
              "responses": {
                "201": { "description": "Relatório agendado" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Cron Jobs API",
      "description": "APIs para jobs agendados: atualização de KPIs, refresh de custos, dispatch de relatórios",
      "files": [
        "web-app/app/api/cron/refresh-kpis/route.ts",
        "web-app/app/api/cron/refresh-costs-mv/route.ts",
        "web-app/app/api/cron/dispatch-reports/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": {
          "title": "Cron Jobs API",
          "version": "1.0.0"
        },
        "paths": {
          "/api/cron/refresh-kpis": {
            "get": {
              "summary": "Atualizar KPIs",
              "responses": {
                "200": { "description": "KPIs atualizados" }
              }
            }
          },
          "/api/cron/dispatch-reports": {
            "get": {
              "summary": "Despachar relatórios agendados",
              "responses": {
                "200": { "description": "Relatórios despachados" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Health Check API",
      "description": "API para verificação de saúde da aplicação e conexão com Supabase",
      "files": [
        "web-app/app/api/health/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": {
          "title": "Health Check API",
          "version": "1.0.0"
        },
        "paths": {
          "/api/health": {
            "get": {
              "summary": "Health check",
              "responses": {
                "200": {
                  "description": "Aplicação saudável",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "ok": { "type": "boolean" },
                          "supabase": { "type": "string", "enum": ["ok", "error"] },
                          "ts": { "type": "string", "format": "date-time" }
                        }
                      }
                    }
                  }
                },
                "500": { "description": "Aplicação com problemas" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Analytics API",
      "description": "API para coleta de métricas de performance (Web Vitals)",
      "files": [
        "web-app/app/api/analytics/web-vitals/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": {
          "title": "Analytics API",
          "version": "1.0.0"
        },
        "paths": {
          "/api/analytics/web-vitals": {
            "post": {
              "summary": "Enviar métricas Web Vitals",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "name": { "type": "string" },
                        "value": { "type": "number" },
                        "id": { "type": "string" },
                        "delta": { "type": "number" }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": { "description": "Métrica registrada" }
              }
            }
          }
        }
      }
    }
  ]
}

