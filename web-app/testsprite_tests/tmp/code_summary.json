{
  "tech_stack": [
    "Next.js 15",
    "React 18",
    "TypeScript",
    "Tailwind CSS",
    "Supabase",
    "PostgreSQL",
    "Google Maps API",
    "Framer Motion",
    "Vercel"
  ],
  "features": [
    {
      "name": "Authentication",
      "description": "User authentication system with Supabase Auth, supporting multiple roles (admin, operator, carrier, driver, passenger) with CSRF protection",
      "files": [
        "app/api/auth/login/route.ts",
        "app/api/auth/csrf/route.ts",
        "app/api/auth/clear-session/route.ts",
        "app/api/auth/set-session/route.ts",
        "app/api/auth/seed-admin/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/auth/login": {
            "post": {
              "summary": "User login endpoint",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "email": {
                          "type": "string",
                          "format": "email"
                        },
                        "password": {
                          "type": "string"
                        }
                      },
                      "required": ["email", "password"]
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Login successful",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "token": {
                            "type": "string"
                          },
                          "refreshToken": {
                            "type": "string"
                          },
                          "user": {
                            "type": "object"
                          },
                          "session": {
                            "type": "object"
                          }
                        }
                      }
                    }
                  }
                },
                "400": {
                  "description": "Invalid credentials or missing data"
                },
                "401": {
                  "description": "Authentication failed"
                },
                "403": {
                  "description": "CSRF validation failed"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Admin - Vehicle Management",
      "description": "CRUD operations for vehicle management including maintenance, checklist, and soft delete with trip validation",
      "files": [
        "app/api/admin/vehicles/[vehicleId]/route.ts",
        "components/admin-map/admin-map.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/admin/vehicles/{vehicleId}": {
            "delete": {
              "summary": "Delete vehicle or mark as inactive if has trips",
              "parameters": [
                {
                  "name": "vehicleId",
                  "in": "path",
                  "required": true,
                  "schema": {
                    "type": "string",
                    "format": "uuid"
                  }
                }
              ],
              "responses": {
                "200": {
                  "description": "Vehicle deleted or archived",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "success": {
                            "type": "boolean"
                          },
                          "archived": {
                            "type": "boolean"
                          },
                          "tripsCount": {
                            "type": "number"
                          }
                        }
                      }
                    }
                  }
                },
                "400": {
                  "description": "Invalid vehicle ID"
                },
                "409": {
                  "description": "Vehicle in use, cannot delete"
                },
                "500": {
                  "description": "Internal server error"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Admin - Route Optimization",
      "description": "Generate optimized stops for routes using Google Directions API with automatic geocoding",
      "files": [
        "app/api/admin/generate-stops/route.ts",
        "app/api/admin/optimize-route/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/admin/generate-stops": {
            "post": {
              "summary": "Generate optimized route stops",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "route_id": {
                          "type": "string",
                          "format": "uuid"
                        }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Stops generated successfully"
                },
                "500": {
                  "description": "Failed to generate stops"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Admin - Operator Management",
      "description": "Create operators and associate them with companies",
      "files": [
        "app/api/admin/create-operator/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/admin/create-operator": {
            "post": {
              "summary": "Create a new operator user",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "email": {
                          "type": "string",
                          "format": "email"
                        },
                        "company_id": {
                          "type": "string",
                          "format": "uuid"
                        }
                      }
                    }
                  }
                }
              },
              "responses": {
                "201": {
                  "description": "Operator created successfully"
                },
                "400": {
                  "description": "Invalid data"
                },
                "500": {
                  "description": "Internal server error"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Cost Management",
      "description": "Complete cost tracking system with categories, budgets, manual entries, import/export, KPIs and reconciliation workflow",
      "files": [
        "app/api/costs/manual/route.ts",
        "app/api/costs/categories/route.ts",
        "app/api/costs/budgets/route.ts",
        "app/api/costs/kpis/route.ts",
        "app/api/costs/import/route.ts",
        "app/api/costs/export/route.ts",
        "app/api/costs/reconcile/route.ts",
        "app/api/costs/vs-budget/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/costs/manual": {
            "post": {
              "summary": "Create manual cost entry",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "company_id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "cost_category_id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "date": {
                          "type": "string",
                          "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
                        },
                        "amount": {
                          "type": "number",
                          "minimum": 0
                        },
                        "notes": {
                          "type": "string"
                        },
                        "source": {
                          "type": "string",
                          "enum": ["manual", "import", "invoice", "calc"]
                        }
                      },
                      "required": ["company_id", "cost_category_id", "date", "amount"]
                    }
                  }
                }
              },
              "responses": {
                "201": {
                  "description": "Cost created successfully"
                },
                "400": {
                  "description": "Invalid data"
                },
                "401": {
                  "description": "Unauthorized"
                },
                "500": {
                  "description": "Internal server error"
                }
              }
            },
            "get": {
              "summary": "Get costs with filters",
              "parameters": [
                {
                  "name": "company_id",
                  "in": "query",
                  "required": true,
                  "schema": {
                    "type": "string"
                  }
                },
                {
                  "name": "route_id",
                  "in": "query",
                  "schema": {
                    "type": "string"
                  }
                },
                {
                  "name": "vehicle_id",
                  "in": "query",
                  "schema": {
                    "type": "string"
                  }
                },
                {
                  "name": "start_date",
                  "in": "query",
                  "schema": {
                    "type": "string"
                  }
                },
                {
                  "name": "end_date",
                  "in": "query",
                  "schema": {
                    "type": "string"
                  }
                },
                {
                  "name": "category_id",
                  "in": "query",
                  "schema": {
                    "type": "string"
                  }
                },
                {
                  "name": "limit",
                  "in": "query",
                  "schema": {
                    "type": "number",
                    "default": 100
                  }
                },
                {
                  "name": "offset",
                  "in": "query",
                  "schema": {
                    "type": "number",
                    "default": 0
                  }
                }
              ],
              "responses": {
                "200": {
                  "description": "List of costs"
                },
                "400": {
                  "description": "Missing company_id"
                },
                "500": {
                  "description": "Internal server error"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Operator - Employee Management",
      "description": "Operators can create employees (passengers) and associate them with companies",
      "files": [
        "app/api/operator/create-employee/route.ts",
        "app/api/operator/associate-company/route.ts",
        "app/operator/page.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/operator/create-employee": {
            "post": {
              "summary": "Create employee as operator",
              "security": [
                {
                  "bearerAuth": []
                }
              ],
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "email": {
                          "type": "string",
                          "format": "email"
                        },
                        "name": {
                          "type": "string"
                        },
                        "phone": {
                          "type": "string"
                        },
                        "role": {
                          "type": "string",
                          "enum": ["admin", "operator", "carrier", "driver", "passenger"],
                          "default": "passenger"
                        }
                      },
                      "required": ["email"]
                    }
                  }
                }
              },
              "responses": {
                "201": {
                  "description": "Employee created",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "userId": {
                            "type": "string"
                          },
                          "created": {
                            "type": "boolean"
                          },
                          "email": {
                            "type": "string"
                          },
                          "role": {
                            "type": "string"
                          },
                          "companyId": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                },
                "200": {
                  "description": "Employee already exists"
                },
                "400": {
                  "description": "Invalid data or operator not associated with company"
                },
                "401": {
                  "description": "Unauthorized"
                },
                "500": {
                  "description": "Internal server error"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Operator - Route Optimization",
      "description": "Optimize routes for operators",
      "files": [
        "app/api/operator/optimize-route/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/operator/optimize-route": {
            "post": {
              "summary": "Optimize route for operator",
              "responses": {
                "200": {
                  "description": "Route optimized successfully"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Reports System",
      "description": "Generate, schedule and dispatch automated reports (PDF/Excel/CSV) with email delivery",
      "files": [
        "app/api/reports/run/route.ts",
        "app/api/reports/schedule/route.ts",
        "app/api/reports/dispatch/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/reports/run": {
            "post": {
              "summary": "Generate report on demand",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "report_type": {
                          "type": "string"
                        },
                        "company_id": {
                          "type": "string"
                        },
                        "format": {
                          "type": "string",
                          "enum": ["pdf", "excel", "csv"]
                        }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Report generated"
                }
              }
            }
          },
          "/api/reports/schedule": {
            "post": {
              "summary": "Schedule report for automatic generation",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "report_type": {
                          "type": "string"
                        },
                        "schedule": {
                          "type": "string"
                        },
                        "email_recipients": {
                          "type": "array",
                          "items": {
                            "type": "string",
                            "format": "email"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "responses": {
                "201": {
                  "description": "Report scheduled"
                }
              }
            }
          },
          "/api/reports/dispatch": {
            "post": {
              "summary": "Dispatch scheduled reports (cron job)",
              "responses": {
                "200": {
                  "description": "Reports dispatched"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Cron Jobs",
      "description": "Automated background tasks for report dispatch, cost materialized view refresh, and KPI updates",
      "files": [
        "app/api/cron/dispatch-reports/route.ts",
        "app/api/cron/refresh-costs-mv/route.ts",
        "app/api/cron/refresh-kpis/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/cron/dispatch-reports": {
            "post": {
              "summary": "Cron job to dispatch scheduled reports",
              "security": [
                {
                  "cronSecret": []
                }
              ],
              "responses": {
                "200": {
                  "description": "Reports dispatched successfully"
                },
                "401": {
                  "description": "Invalid CRON_SECRET"
                }
              }
            }
          },
          "/api/cron/refresh-costs-mv": {
            "post": {
              "summary": "Cron job to refresh costs materialized view",
              "security": [
                {
                  "cronSecret": []
                }
              ],
              "responses": {
                "200": {
                  "description": "Materialized view refreshed"
                },
                "401": {
                  "description": "Invalid CRON_SECRET"
                }
              }
            }
          },
          "/api/cron/refresh-kpis": {
            "post": {
              "summary": "Cron job to refresh KPI data",
              "security": [
                {
                  "cronSecret": []
                }
              ],
              "responses": {
                "200": {
                  "description": "KPIs refreshed"
                },
                "401": {
                  "description": "Invalid CRON_SECRET"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Web Vitals Analytics",
      "description": "Track and store web performance metrics (CLS, LCP, FID, TTFB) for monitoring",
      "files": [
        "app/api/analytics/web-vitals/route.ts",
        "components/web-vitals-init.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/analytics/web-vitals": {
            "post": {
              "summary": "Store web vitals metric",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": {
                      "type": "object",
                      "properties": {
                        "metric_name": {
                          "type": "string",
                          "enum": ["CLS", "LCP", "FID", "TTFB"]
                        },
                        "value": {
                          "type": "number"
                        },
                        "rating": {
                          "type": "string",
                          "enum": ["good", "needs-improvement", "poor"]
                        },
                        "pathname": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              },
              "responses": {
                "200": {
                  "description": "Metric stored"
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Health Check",
      "description": "System health check endpoint for monitoring",
      "files": [
        "app/api/health/route.ts"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "paths": {
          "/api/health": {
            "get": {
              "summary": "Health check endpoint",
              "responses": {
                "200": {
                  "description": "System healthy",
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "status": {
                            "type": "string",
                            "example": "ok"
                          },
                          "timestamp": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "Admin Dashboard",
      "description": "Main admin dashboard with KPIs, fleet map, real-time tracking, and management interface",
      "files": [
        "app/admin/page.tsx",
        "app/admin/dashboard/page.tsx",
        "app/admin/vehicles/page.tsx",
        "app/admin/routes/page.tsx",
        "app/admin/drivers/page.tsx",
        "app/admin/companies/page.tsx",
        "components/admin-map/admin-map.tsx",
        "components/kpi-card.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": {
          "title": "Admin Dashboard UI",
          "description": "Frontend pages for admin management"
        }
      }
    },
    {
      "name": "Operator Portal",
      "description": "Operator interface for employee management and route visualization",
      "files": [
        "app/operator/page.tsx",
        "app/operator/employees/page.tsx",
        "app/operator/routes/page.tsx",
        "components/operator/operator-dashboard.tsx"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": {
          "title": "Operator Portal UI",
          "description": "Frontend pages for operator role"
        }
      }
    }
  ]
}

